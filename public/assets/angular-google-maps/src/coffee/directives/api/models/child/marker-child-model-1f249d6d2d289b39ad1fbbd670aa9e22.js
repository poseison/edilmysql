(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function o(){this.constructor=t}for(var s in i)e.call(i,s)&&(t[s]=i[s]);return o.prototype=i.prototype,t.prototype=new o,t.__super__=i.prototype,t};this.ngGmapModule("directives.api.models.child",function(){return this.MarkerChildModel=function(e){function o(e,i,o,s,r,n,a,l,h){var c;this.index=e,this.model=i,this.parentScope=o,this.gMap=s,this.defaults=n,this.doClick=a,this.gMarkerManager=l,this.watchDestroy=t(this.watchDestroy,this),this.setLabelOptions=t(this.setLabelOptions,this),this.isLabelDefined=t(this.isLabelDefined,this),this.setOptions=t(this.setOptions,this),this.setIcon=t(this.setIcon,this),this.setCoords=t(this.setCoords,this),this.destroy=t(this.destroy,this),this.maybeSetScopeValue=t(this.maybeSetScopeValue,this),this.createMarker=t(this.createMarker,this),this.setMyScope=t(this.setMyScope,this),c=this,this.iconKey=this.parentScope.icon,this.coordsKey=this.parentScope.coords,this.clickKey=this.parentScope.click(),this.labelContentKey=this.parentScope.labelContent,this.optionsKey=this.parentScope.options,this.labelOptionsKey=this.parentScope.labelOptions,this.myScope=this.parentScope.$new(!1),this.$injector=h,this.myScope.model=this.model,this.setMyScope(this.model,void 0,!0),this.createMarker(this.model),this.myScope.$watch("model",function(t){return function(e,i){return e!==i?t.setMyScope(e,i):void 0}}(this),!0),this.$log=directives.api.utils.Logger,this.$log.info(c),this.watchDestroy(this.myScope)}return i(o,e),o.include(directives.api.utils.GmapUtil),o.prototype.setMyScope=function(t,e,i){return null==e&&(e=void 0),null==i&&(i=!1),this.maybeSetScopeValue("icon",t,e,this.iconKey,this.evalModelHandle,i,this.setIcon),this.maybeSetScopeValue("coords",t,e,this.coordsKey,this.evalModelHandle,i,this.setCoords),this.maybeSetScopeValue("labelContent",t,e,this.labelContentKey,this.evalModelHandle,i),_.isFunction(this.clickKey)&&this.$injector?this.myScope.click=function(e){return function(){return e.$injector.invoke(e.clickKey,void 0,{$markerModel:t})}}(this):this.maybeSetScopeValue("click",t,e,this.clickKey,this.evalModelHandle,i),this.createMarker(t,e,i)},o.prototype.createMarker=function(t,e,i){return null==e&&(e=void 0),null==i&&(i=!1),this.maybeSetScopeValue("options",t,e,this.optionsKey,function(t){return function(e,i){var o;return void 0===e?void 0:(o="self"===i?e:e[i],void 0===o?o=void 0===i?t.defaults:t.myScope.options:o)}}(this),i,this.setOptions)},o.prototype.evalModelHandle=function(t,e){return void 0===t?void 0:"self"===e?t:t[e]},o.prototype.maybeSetScopeValue=function(t,e,i,o,s,r,n){var a,l;return null==n&&(n=void 0),void 0===i?(this.myScope[t]=s(e,o),void(r||null!=n&&n(this.myScope))):(l=s(i,o),a=s(e,o),a===l||this.myScope[t]===a||(this.myScope[t]=a,r)?void 0:(null!=n&&n(this.myScope),this.gMarkerManager.draw()))},o.prototype.destroy=function(){return this.myScope.$destroy()},o.prototype.setCoords=function(t){return t.$id===this.myScope.$id&&void 0!==this.gMarker?null!=t.coords?null==this.scope.coords.latitude||null==this.scope.coords.longitude?void this.$log.error("MarkerChildMarker cannot render marker as scope.coords as no position on marker: "+JSON.stringify(this.model)):(this.gMarker.setPosition(new google.maps.LatLng(t.coords.latitude,t.coords.longitude)),this.gMarker.setVisible(null!=t.coords.latitude&&null!=t.coords.longitude),this.gMarkerManager.remove(this.gMarker),this.gMarkerManager.add(this.gMarker)):this.gMarkerManager.remove(this.gMarker):void 0},o.prototype.setIcon=function(t){return t.$id===this.myScope.$id&&void 0!==this.gMarker?(this.gMarkerManager.remove(this.gMarker),this.gMarker.setIcon(t.icon),this.gMarkerManager.add(this.gMarker),this.gMarker.setPosition(new google.maps.LatLng(t.coords.latitude,t.coords.longitude)),this.gMarker.setVisible(t.coords.latitude&&null!=t.coords.longitude)):void 0},o.prototype.setOptions=function(t){var e;if(t.$id===this.myScope.$id&&(null!=this.gMarker&&(this.gMarkerManager.remove(this.gMarker),delete this.gMarker),null!=(e=t.coords)?e:"function"==typeof t.icon?t.icon(null!=t.options):void 0))return this.opts=this.createMarkerOptions(t.coords,t.icon,t.options),delete this.gMarker,this.gMarker=this.isLabelDefined(t)?new MarkerWithLabel(this.setLabelOptions(this.opts,t)):new google.maps.Marker(this.opts),this.gMarkerManager.add(this.gMarker),google.maps.event.addListener(this.gMarker,"click",function(t){return function(){return t.doClick&&null!=t.myScope.click?t.myScope.click():void 0}}(this))},o.prototype.isLabelDefined=function(t){return null!=t.labelContent},o.prototype.setLabelOptions=function(t,e){return t.labelAnchor=this.getLabelPositionPoint(e.labelAnchor),t.labelClass=e.labelClass,t.labelContent=e.labelContent,t},o.prototype.watchDestroy=function(t){return t.$on("$destroy",function(t){return function(){var e;return null!=t.gMarker&&(t.gMarkerManager.remove(t.gMarker),delete t.gMarker),e=void 0}}(this))},o}(oo.BaseObject)})}).call(this);