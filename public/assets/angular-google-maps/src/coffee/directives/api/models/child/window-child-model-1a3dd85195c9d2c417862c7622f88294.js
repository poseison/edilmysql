(function(){var t=function(t,i){return function(){return t.apply(i,arguments)}},i={}.hasOwnProperty,e=function(t,e){function n(){this.constructor=t}for(var s in e)i.call(e,s)&&(t[s]=e[s]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};this.ngGmapModule("directives.api.models.child",function(){return this.WindowChildModel=function(i){function n(i,e,n,s,o,r,l,h,a,c){this.element=a,null==c&&(c=!1),this.destroy=t(this.destroy,this),this.hideWindow=t(this.hideWindow,this),this.getLatestPosition=t(this.getLatestPosition,this),this.showWindow=t(this.showWindow,this),this.handleClick=t(this.handleClick,this),this.watchCoords=t(this.watchCoords,this),this.watchShow=t(this.watchShow,this),this.createGWin=t(this.createGWin,this),this.scope=i,this.googleMapsHandles=[],this.opts=e,this.mapCtrl=s,this.markerCtrl=o,this.isIconVisibleOnClick=n,this.initialMarkerVisibility=null!=this.markerCtrl?this.markerCtrl.getVisible():!1,this.$log=directives.api.utils.Logger,this.$http=r,this.$templateCache=l,this.$compile=h,this.createGWin(),null!=this.markerCtrl&&this.markerCtrl.setClickable(!0),this.handleClick(),this.watchShow(),this.watchCoords(),this.needToManualDestroy=c,this.$log.info(this)}return e(n,i),n.include(directives.api.utils.GmapUtil),n.prototype.createGWin=function(){var t,i;return null==this.gWin&&null!=this.markerCtrl&&(t=null!=this.opts?this.opts:{},i=null!=this.element&&_.isFunction(this.element.html)?this.element.html():this.element,this.opts=null!=this.markerCtrl?this.createWindowOptions(this.markerCtrl,this.scope,i,t):{}),null!=this.opts&&void 0===this.gWin?(this.gWin=this.opts.boxClass&&window.InfoBox&&"function"==typeof window.InfoBox?new window.InfoBox(this.opts):new google.maps.InfoWindow(this.opts),this.googleMapsHandles.push(google.maps.event.addListener(this.gWin,"closeclick",function(t){return function(){return null!=t.markerCtrl&&t.markerCtrl.setVisible(t.initialMarkerVisibility),t.gWin.isOpen(!1),null!=t.scope.closeClick?t.scope.closeClick():void 0}}(this)))):void 0},n.prototype.watchShow=function(){return this.scope.$watch("show",function(t){return function(i){return i?t.showWindow():t.hideWindow()}}(this))},n.prototype.watchCoords=function(){var t;return t=null!=this.markerCtrl?this.scope.$parent:this.scope,t.$watch("coords",function(t){return function(i,e){return i!==e?null==i?t.hideWindow():null==i.latitude||null==i.longitude?void t.$log.error("WindowChildMarker cannot render marker as scope.coords as no position on marker: "+JSON.stringify(t.model)):t.gWin.setPosition(new google.maps.LatLng(i.latitude,i.longitude)):void 0}}(this),!0)},n.prototype.handleClick=function(){return null!=this.markerCtrl?this.googleMapsHandles.push(google.maps.event.addListener(this.markerCtrl,"click",function(t){return function(){var i;return null==t.gWin&&t.createGWin(),i=t.markerCtrl.getPosition(),null!=t.gWin&&(t.gWin.setPosition(i),t.showWindow()),t.initialMarkerVisibility=t.markerCtrl.getVisible(),t.markerCtrl.setVisible(t.isIconVisibleOnClick)}}(this))):void 0},n.prototype.showWindow=function(){var t;return t=function(t){return function(){return!t.gWin||!t.scope.show&&null!=t.scope.show||t.gWin.isOpen()?void 0:t.gWin.open(t.mapCtrl)}}(this),this.scope.templateUrl?this.gWin?this.$http.get(this.scope.templateUrl,{cache:this.$templateCache}).then(function(i){return function(e){var n,s;return s=i.scope.$new(),angular.isDefined(i.scope.templateParameter)&&(s.parameter=i.scope.templateParameter),n=i.$compile(e.data)(s),i.gWin.setContent(n[0]),t()}}(this)):void 0:t()},n.prototype.getLatestPosition=function(){return null!=this.gWin&&null!=this.markerCtrl?this.gWin.setPosition(this.markerCtrl.getPosition()):void 0},n.prototype.hideWindow=function(){return null!=this.gWin&&this.gWin.isOpen()?this.gWin.close():void 0},n.prototype.destroy=function(){var t;return this.hideWindow(),_.each(this.googleMapsHandles,function(t){return google.maps.event.removeListener(t)}),this.googleMapsHandles.length=0,null!=this.scope&&this.needToManualDestroy&&this.scope.$destroy(),delete this.gWin,t=void 0},n}(oo.BaseObject)})}).call(this);