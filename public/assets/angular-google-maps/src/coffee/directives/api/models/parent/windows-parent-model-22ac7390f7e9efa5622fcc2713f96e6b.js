(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,i=function(t,i){function s(){this.constructor=t}for(var n in i)e.call(i,n)&&(t[n]=i[n]);return s.prototype=i.prototype,t.prototype=new s,t.__super__=i.prototype,t};this.ngGmapModule("directives.api.models.parent",function(){return this.WindowsParentModel=function(e){function s(e,i,n,o,r,h,c,d,l){this.interpolateContent=t(this.interpolateContent,this),this.setChildScope=t(this.setChildScope,this),this.createWindow=t(this.createWindow,this),this.setContentKeys=t(this.setContentKeys,this),this.createChildScopesWindows=t(this.createChildScopesWindows,this),this.onMarkerModelsReady=t(this.onMarkerModelsReady,this),this.watchOurScope=t(this.watchOurScope,this),this.destroy=t(this.destroy,this),this.watchDestroy=t(this.watchDestroy,this),this.watchModels=t(this.watchModels,this),this.watch=t(this.watch,this);var u,a,p,f,w;for(s.__super__.constructor.call(this,e,i,n,o,r,h,c,d,l),a=this,this.$interpolate=l,this.windows=[],this.windwsIndex=0,this.scopePropNames=["show","coords","templateUrl","templateParameter","isIconVisibleOnClick","closeClick"],w=this.scopePropNames,p=0,f=w.length;f>p;p++)u=w[p],this[u+"Key"]=void 0;this.linked=new directives.api.utils.Linked(e,i,n,o),this.models=void 0,this.contentKeys=void 0,this.isIconVisibleOnClick=void 0,this.firstTime=!0,this.bigGulp=directives.api.utils.AsyncProcessor,this.$log.info(a),this.$timeout(function(t){return function(){return t.watchOurScope(e),t.createChildScopesWindows()}}(this),50)}return i(s,e),s.include(directives.api.utils.ModelsWatcher),s.prototype.watch=function(t,e,i){return t.$watch(e,function(t){return function(s,n){return s!==n?(t[i]="function"==typeof s?s():s,_.each(t.windows,function(s){return s.scope[e]="self"===t[i]?s:s[t[i]]})):void 0}}(this),!0)},s.prototype.watchModels=function(t){return t.$watch("models",function(t){return function(e,i){return t.didModelsChange(e,i)?(t.destroy(),t.createChildScopesWindows()):void 0}}(this))},s.prototype.watchDestroy=function(t){return t.$on("$destroy",function(t){return function(){return t.destroy()}}(this))},s.prototype.destroy=function(){return _.each(this.windows,function(){return function(t){return t.destroy()}}(this)),delete this.windows,this.windows=[],this.windowsIndex=0},s.prototype.watchOurScope=function(t){return _.each(this.scopePropNames,function(e){return function(i){var s;return s=i+"Key",e[s]="function"==typeof t[i]?t[i]():t[i],e.watch(t,i,s)}}(this))},s.prototype.onMarkerModelsReady=function(t){return this.destroy(),this.models=t.models,this.firstTime&&this.watchDestroy(t),this.setContentKeys(t.models),this.bigGulp.handleLargeArray(t.markerModels,function(t){return function(e){return t.createWindow(e.model,e.gMarker,t.gMap)}}(this),function(){},function(t){return function(){return t.firstTime=!1}}(this))},s.prototype.createChildScopesWindows=function(){var t,e;if(this.isIconVisibleOnClick=!0,angular.isDefined(this.linked.attrs.isiconvisibleonclick)&&(this.isIconVisibleOnClick=this.linked.scope.isIconVisibleOnClick),this.gMap=this.linked.ctrls[0].getMap(),t=this.linked.ctrls.length>1&&null!=this.linked.ctrls[1]?this.linked.ctrls[1].getMarkersScope():void 0,e=angular.isUndefined(this.linked.scope.models),e&&(void 0===t||void 0===t.markerModels&&void 0===t.models))return void this.$log.info("No models to create windows from! Need direct models or models derrived from markers!");if(null!=this.gMap){if(null!=this.linked.scope.models)return this.models=this.linked.scope.models,this.firstTime&&(this.watchModels(this.linked.scope),this.watchDestroy(this.linked.scope)),this.setContentKeys(this.linked.scope.models),this.bigGulp.handleLargeArray(this.linked.scope.models,function(t){return function(e){return t.createWindow(e,void 0,t.gMap)}}(this),function(){},function(t){return function(){return t.firstTime=!1}}(this));if(t.onMarkerModelsReady=this.onMarkerModelsReady,t.isMarkerModelsReady)return this.onMarkerModelsReady(t)}},s.prototype.setContentKeys=function(t){return t.length>0?this.contentKeys=Object.keys(t[0]):void 0},s.prototype.createWindow=function(t,e,i){var s,n,o;return s=this.linked.scope.$new(!1),this.setChildScope(s,t),s.$watch("model",function(t){return function(e,i){return e!==i?t.setChildScope(s,e):void 0}}(this),!0),o=this.interpolateContent(this.linked.element.html(),t),n=this.createWindowOptions(e,s,o,this.DEFAULTS),this.windows.push(new directives.api.models.child.WindowChildModel(s,n,this.isIconVisibleOnClick,i,e,this.$http,this.$templateCache,this.$compile,void 0,!0))},s.prototype.setChildScope=function(t,e){var i,s,n,o,r;for(r=this.scopePropNames,s=function(i){return function(s){var n,o;return n=s+"Key",o="self"===i[n]?e:e[i[n]],o!==t[s]?t[s]=o:void 0}}(this),n=0,o=r.length;o>n;n++)i=r[n],s(i);return t.model=e},s.prototype.interpolateContent=function(t,e){var i,s,n,o,r,h;if(void 0!==this.contentKeys&&0!==this.contentKeys.length){for(i=this.$interpolate(t),s={},h=this.contentKeys,o=0,r=h.length;r>o;o++)n=h[o],s[n]=e[n];return i(s)}},s}(directives.api.models.parent.IWindowParentModel)})}).call(this);